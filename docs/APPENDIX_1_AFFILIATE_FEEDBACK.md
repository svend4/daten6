# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 1: –°–∏—Å—Ç–µ–º–∞ –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π –û–±—Ä–∞—Ç–Ω–æ–π –°–≤—è–∑–∏ –∏ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ö–æ–º–ø–∏–ª—è—Ü–∏–∏ –ö–æ–Ω—Ç–µ–Ω—Ç–∞

## üìã –°—Ç–∞—Ç—É—Å –î–æ–∫—É–º–µ–Ω—Ç–∞

**–¢–∏–ø:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2024-12-28
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- [VERSIONING_SYSTEM.md](VERSIONING_SYSTEM.md)
- [PLUGIN_ANCHOR_SYSTEM.md](PLUGIN_ANCHOR_SYSTEM.md)

---

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ü–æ—Ç–æ–∫ –ö–æ–Ω—Ç–µ–Ω—Ç–∞

### –û—Å–Ω–æ–≤–Ω–∞—è –ò–¥–µ—è

–°–æ–∑–¥–∞–Ω–∏–µ **—ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞** —Å –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∏ –≥–ª–∞–≤–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º, –≥–¥–µ –æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∞—Ç—å–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–¢–†–ê–ù–ò–¶–´ –ü–ê–†–¢–ù–Å–†–û–í (Affiliate)              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ –û—Ç–µ–ª—å –ê  ‚îÇ  ‚îÇ –ê–≤–∏–∞ –ë   ‚îÇ  ‚îÇ –†–µ—Å—Ç–æ—Ä–∞–Ω ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ + –æ—Ç–∑—ã–≤—ã ‚îÇ  ‚îÇ + –æ—Ç–∑—ã–≤—ã ‚îÇ  ‚îÇ + –æ—Ç–∑—ã–≤—ã ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì ‚Üì ‚Üì           ‚Üë ‚Üë ‚Üë
    –û—Ç–∑—ã–≤—ã –≤–Ω–∏–∑    –°—Ç–∞—Ç—å–∏ –≤–≤–µ—Ä—Ö
         ‚Üì ‚Üì ‚Üì           ‚Üë ‚Üë ‚Üë
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê (–°–≤–æ–±–æ–¥–Ω–∞—è –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è)      ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  [–≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –¶–∏—Ç–∞—Ç] ‚Üí [–ö–∞—Ç–∞–ª–æ–≥ –¶–∏—Ç–∞—Ç] ‚Üí            ‚îÇ
‚îÇ  ‚Üí [–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –°—Ç–∞—Ç–µ–π] ‚Üí [–°—Ç–∞—Ç—å—è –í–∏–∫–∏–ø–µ–¥–∏–∏]        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –°—Ç–∞—Ç—å—è: "–í–µ–Ω–µ—Ü–∏—è - –ì–æ—Ä–æ–¥ –Ω–∞ –í–æ–¥–µ"                 ‚îÇ
‚îÇ  ‚îú‚îÄ –†–∞–∑–¥–µ–ª 1: –ò—Å—Ç–æ—Ä–∏—è (–∏–∑ –í–∏–∫–∏–ø–µ–¥–∏–∏)               ‚îÇ
‚îÇ  ‚îú‚îÄ –†–∞–∑–¥–µ–ª 2: –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫–æ–º–ø–∏–ª—è—Ü–∏—è)   ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ –¶–∏—Ç–∞—Ç–∞ 1 (–∏–∑ –æ—Ç–∑—ã–≤–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –ê)           ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ –¶–∏—Ç–∞—Ç–∞ 2 (–∏–∑ –æ—Ç–∑—ã–≤–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –ë)           ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ –¶–∏—Ç–∞—Ç–∞ 3 (–∏–∑ –æ—Ç–∑—ã–≤–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –í)           ‚îÇ
‚îÇ  ‚îî‚îÄ –†–∞–∑–¥–µ–ª 3: –û—Ç–∑—ã–≤—ã —Ç—É—Ä–∏—Å—Ç–æ–≤ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
    –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
         ‚Üì
    –ü–∞—Ä—Ç–Ω—ë—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –≤–∏–¥–∂–µ—Ç —Å–æ —Å—Ç–∞—Ç—å—ë–π
```

---

## üíº –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ü—Ä–æ–≥—Ä–∞–º–º–∞ (Affiliate System)

### –ü—Ä–∏–Ω—Ü–∏–ø –†–∞–±–æ—Ç—ã

**–ü–∞—Ä—Ç–Ω—ë—Ä** - —ç—Ç–æ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–æ—Ç–µ–ª—å, –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è, —Ä–µ—Å—Ç–æ—Ä–∞–Ω), –∫–æ—Ç–æ—Ä—ã–π:
1. –†–∞–∑–º–µ—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
2. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –∑–∞ –ø—Ä–æ–¥–∞–∂–∏
3. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ü–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ** –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å—Ç–∞—Ç—å–∏)

### –°—Ö–µ–º–∞ –ü–∞—Ä—Ç–Ω—ë—Ä–∞

```javascript
const PartnerSchema = new mongoose.Schema({
  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  partnerId: {
    type: String,
    unique: true,
    required: true
    // –§–æ—Ä–º–∞—Ç: "PARTNER-{TYPE}-{NUMBER}"
    // –ü—Ä–∏–º–µ—Ä: "PARTNER-HOTEL-001"
  },

  name: String,                    // "–û—Ç–µ–ª—å –í–µ–Ω–µ—Ü–∏—è"
  type: {
    type: String,
    enum: ['hotel', 'airline', 'restaurant', 'tour', 'attraction'],
    required: true
  },

  // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  contact: {
    website: String,
    email: String,
    phone: String,
    address: String
  },

  // –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
  affiliate: {
    commissionRate: Number,        // 5% –∫–æ–º–∏—Å—Å–∏–∏
    trackingCode: String,          // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
    totalSales: Number,            // –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂
    totalCommission: Number,       // –û–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è
    status: {
      type: String,
      enum: ['active', 'pending', 'suspended'],
      default: 'pending'
    }
  },

  // API –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤
  reviewsAPI: {
    endpoint: String,              // URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
    format: String,                // json, xml, rss
    updateFrequency: Number,       // –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–º—Å)
    lastSync: Date                 // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
  },

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  stats: {
    totalReviews: Number,          // –í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤
    quotesExtracted: Number,       // –ò–∑–≤–ª–µ—á–µ–Ω–æ —Ü–∏—Ç–∞—Ç
    articlesCreated: Number        // –°–æ–∑–¥–∞–Ω–æ —Å—Ç–∞—Ç–µ–π
  },

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
  feedback: {
    receiveArticles: Boolean,      // –ü–æ–ª—É—á–∞—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
    displayWidget: Boolean,        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç —Å–æ —Å—Ç–∞—Ç—å—è–º–∏
    autoPublish: Boolean           // –ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤
  }
});
```

### –ü—Ä–∏–º–µ—Ä –ü–∞—Ä—Ç–Ω—ë—Ä–∞

```javascript
{
  partnerId: "PARTNER-HOTEL-001",
  name: "Grand Hotel Venezia",
  type: "hotel",

  contact: {
    website: "https://grand-hotel-venezia.com",
    email: "info@grand-hotel-venezia.com"
  },

  affiliate: {
    commissionRate: 5,             // 5%
    trackingCode: "VEN-GH-12345",
    totalSales: 125000,            // ‚Ç¨125,000
    totalCommission: 6250,         // ‚Ç¨6,250
    status: "active"
  },

  reviewsAPI: {
    endpoint: "https://grand-hotel-venezia.com/api/reviews",
    format: "json",
    updateFrequency: 3600000,      // 1 —á–∞—Å
    lastSync: "2024-12-28T10:00:00Z"
  },

  stats: {
    totalReviews: 1547,
    quotesExtracted: 342,
    articlesCreated: 12
  },

  feedback: {
    receiveArticles: true,
    displayWidget: true,
    autoPublish: true
  }
}
```

---

## üí¨ –°–∏—Å—Ç–µ–º–∞ –û—Ç–∑—ã–≤–æ–≤ —Å –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –ü–æ—Ç–æ–∫–æ–º

### –°—Ö–µ–º–∞ –û—Ç–∑—ã–≤–∞

```javascript
const ReviewSchema = new mongoose.Schema({
  reviewId: String,                // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID

  // –ò—Å—Ç–æ—á–Ω–∏–∫
  source: {
    partnerId: String,             // ID –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    partnerName: String,           // –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    originalUrl: String,           // URL –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞
    importedAt: Date               // –ö–æ–≥–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
  },

  // –ê–≤—Ç–æ—Ä
  author: {
    name: String,
    country: String,
    avatar: String,
    verified: Boolean              // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  },

  // –ö–æ–Ω—Ç–µ–Ω—Ç
  content: {
    title: String,                 // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–∑—ã–≤–∞
    text: String,                  // –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    rating: Number,                // 1-5 –∑–≤—ë–∑–¥
    date: Date,                    // –î–∞—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è

    // –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    language: String,              // –Ø–∑—ã–∫ (ru, en, etc.)
    sentiment: String,             // positive, negative, neutral
    keywords: [String]             // –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
  },

  // –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è —Ü–∏—Ç–∞—Ç
  quotes: [{
    text: String,                  // –¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã
    startIndex: Number,            // –ù–∞—á–∞–ª–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
    endIndex: Number,              // –ö–æ–Ω–µ—Ü
    importance: Number,            // 0-100 (–≤–∞–∂–Ω–æ—Å—Ç—å)
    category: String,              // location, food, service, etc.
    isUnique: Boolean,             // –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞
    usedInArticles: [String]       // ID —Å—Ç–∞—Ç–µ–π, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
  }],

  // –û–±—Ä–∞–±–æ—Ç–∫–∞
  processing: {
    status: String,                // pending, processed, published
    extractedQuotes: Number,       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
    compiledToArticles: [String],  // ID —Å—Ç–∞—Ç–µ–π
    processedAt: Date
  },

  // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
  published: {
    onMainSite: Boolean,           // –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
    onPartnerSite: Boolean,        // –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —É –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    inEncyclopedia: Boolean        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏
  }
});
```

### –ü—Ä–∏–º–µ—Ä –û—Ç–∑—ã–≤–∞

```javascript
{
  reviewId: "REV-VEN-001-00123",

  source: {
    partnerId: "PARTNER-HOTEL-001",
    partnerName: "Grand Hotel Venezia",
    originalUrl: "https://grand-hotel-venezia.com/reviews/123",
    importedAt: "2024-12-20T14:30:00Z"
  },

  author: {
    name: "–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",
    country: "–†–æ—Å—Å–∏—è",
    verified: true
  },

  content: {
    title: "–ù–µ–∑–∞–±—ã–≤–∞–µ–º—ã–π –æ—Ç–¥—ã—Ö –≤ –í–µ–Ω–µ—Ü–∏–∏!",
    text: "–ü—Ä–æ–≤–µ–ª–∏ –Ω–µ–¥–µ–ª—é –≤ Grand Hotel Venezia –∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ. \"–í–∏–¥ –∏–∑ –æ–∫–Ω–∞ –Ω–∞ –ì—Ä–∞–Ω–¥-–∫–∞–Ω–∞–ª –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π!\" –ó–∞–≤—Ç—Ä–∞–∫–∏ –æ—á–µ–Ω—å –≤–∫—É—Å–Ω—ã–µ. \"–ü–µ—Ä—Å–æ–Ω–∞–ª –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –≥–æ–≤–æ—Ä–∏—Ç –ø–æ-—Ä—É—Å—Å–∫–∏.\" –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å —ç–∫—Å–∫—É—Ä—Å–∏—è –Ω–∞ –≥–æ–Ω–¥–æ–ª–µ, –∫–æ—Ç–æ—Ä—É—é –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–ª –æ—Ç–µ–ª—å. \"–ü–ª–æ—â–∞–¥—å –°–∞–Ω-–ú–∞—Ä–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å–µ–≥–æ –≤ 5 –º–∏–Ω—É—Ç–∞—Ö —Ö–æ–¥—å–±—ã.\" –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω—ë–º—Å—è!",
    rating: 5,
    date: "2024-12-15T10:00:00Z",
    language: "ru",
    sentiment: "positive",
    keywords: ["–≤–µ–Ω–µ—Ü–∏—è", "–æ—Ç–µ–ª—å", "–≥—Ä–∞–Ω–¥-–∫–∞–Ω–∞–ª", "—Å–∞–Ω-–º–∞—Ä–∫–æ"]
  },

  quotes: [
    {
      text: "–í–∏–¥ –∏–∑ –æ–∫–Ω–∞ –Ω–∞ –ì—Ä–∞–Ω–¥-–∫–∞–Ω–∞–ª –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π!",
      startIndex: 67,
      endIndex: 118,
      importance: 85,
      category: "location",
      isUnique: true,
      usedInArticles: ["ARTICLE-VEN-HOTELS"]
    },
    {
      text: "–ü–µ—Ä—Å–æ–Ω–∞–ª –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –≥–æ–≤–æ—Ä–∏—Ç –ø–æ-—Ä—É—Å—Å–∫–∏.",
      startIndex: 145,
      endIndex: 199,
      importance: 70,
      category: "service",
      isUnique: true,
      usedInArticles: []
    },
    {
      text: "–ü–ª–æ—â–∞–¥—å –°–∞–Ω-–ú–∞—Ä–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å–µ–≥–æ –≤ 5 –º–∏–Ω—É—Ç–∞—Ö —Ö–æ–¥—å–±—ã.",
      startIndex: 280,
      endIndex: 336,
      importance: 90,
      category: "location",
      isUnique: false,  // –ü–æ—Ö–æ–∂–∏–µ —Ü–∏—Ç–∞—Ç—ã —É–∂–µ –µ—Å—Ç—å
      usedInArticles: ["ARTICLE-VEN-ATTRACTIONS"]
    }
  ],

  processing: {
    status: "processed",
    extractedQuotes: 3,
    compiledToArticles: ["ARTICLE-VEN-HOTELS", "ARTICLE-VEN-ATTRACTIONS"],
    processedAt: "2024-12-20T15:00:00Z"
  },

  published: {
    onMainSite: true,
    onPartnerSite: true,
    inEncyclopedia: true
  }
}
```

---

## üìù –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –¶–∏—Ç–∞—Ç (Quote Extraction)

### –ê–ª–≥–æ—Ä–∏—Ç–º –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏

#### 1. –ü—Ä–æ—Å—Ç–æ–π –ú–µ—Ç–æ–¥ (–±–µ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π)

```javascript
class QuoteExtractor {
  /**
   * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ä–∫–µ—Ä–æ–≤
   */
  extractQuotes(text) {
    const quotes = [];

    // –ú–µ—Ç–æ–¥ 1: –¢–µ–∫—Å—Ç –≤ –∫–∞–≤—ã—á–∫–∞—Ö
    const quotedPattern = /"([^"]+)"/g;
    let match;
    while ((match = quotedPattern.exec(text)) !== null) {
      quotes.push({
        text: match[1],
        startIndex: match.index,
        endIndex: match.index + match[0].length,
        method: 'quoted',
        markerType: 'double-quotes'
      });
    }

    // –ú–µ—Ç–æ–¥ 2: –¢–µ–∫—Å—Ç –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–∫–∞—Ö
    const singleQuotedPattern = /'([^']+)'/g;
    while ((match = singleQuotedPattern.exec(text)) !== null) {
      quotes.push({
        text: match[1],
        startIndex: match.index,
        endIndex: match.index + match[0].length,
        method: 'quoted',
        markerType: 'single-quotes'
      });
    }

    // –ú–µ—Ç–æ–¥ 3: –¢–µ–∫—Å—Ç –≤ —Å–∫–æ–±–∫–∞—Ö (–æ—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏)
    const bracketPattern = /\[([^\]]+)\]/g;
    while ((match = bracketPattern.exec(text)) !== null) {
      quotes.push({
        text: match[1],
        startIndex: match.index,
        endIndex: match.index + match[0].length,
        method: 'bracketed',
        markerType: 'square-brackets'
      });
    }

    // –ú–µ—Ç–æ–¥ 4: –í–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
    const exclamationPattern = /([–ê-–ØA-Z][^.!?]*!)/g;
    while ((match = exclamationPattern.exec(text)) !== null) {
      if (match[1].length > 20 && match[1].length < 200) {
        quotes.push({
          text: match[1],
          startIndex: match.index,
          endIndex: match.index + match[0].length,
          method: 'exclamatory',
          markerType: 'exclamation'
        });
      }
    }

    return quotes;
  }

  /**
   * –û—Ü–µ–Ω–∫–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏ —Ü–∏—Ç–∞—Ç—ã
   */
  calculateImportance(quote, context) {
    let score = 50; // –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª

    // +20 –µ—Å–ª–∏ —Ü–∏—Ç–∞—Ç–∞ –≤ –∫–∞–≤—ã—á–∫–∞—Ö
    if (quote.markerType === 'double-quotes') score += 20;

    // +15 –µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫
    if (quote.text.includes('!')) score += 15;

    // +10 –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    const keywords = ['–ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π', '–Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–π', '–≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω—ã–π',
                      '—É–∂–∞—Å–Ω—ã–π', '–ø–ª–æ—Ö–æ–π', '–æ—Ç–ª–∏—á–Ω—ã–π'];
    keywords.forEach(keyword => {
      if (quote.text.toLowerCase().includes(keyword)) score += 10;
    });

    // +5 –∑–∞ –∫–∞–∂–¥—ã–µ 10 —Å–ª–æ–≤ (–Ω–æ –Ω–µ –±–æ–ª–µ–µ +25)
    const wordCount = quote.text.split(' ').length;
    score += Math.min(Math.floor(wordCount / 10) * 5, 25);

    return Math.min(score, 100);
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ü–∏—Ç–∞—Ç—ã
   */
  async isUnique(quote, existingQuotes) {
    // –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Å—Ö–æ–¥—Å—Ç–≤—É —Ç–µ–∫—Å—Ç–∞
    const similarity = (a, b) => {
      const longer = a.length > b.length ? a : b;
      const shorter = a.length > b.length ? b : a;
      if (longer.length === 0) return 1.0;
      return (longer.length - this.editDistance(longer, shorter)) / longer.length;
    };

    for (const existing of existingQuotes) {
      const sim = similarity(
        quote.text.toLowerCase(),
        existing.text.toLowerCase()
      );

      // –ï—Å–ª–∏ —Å—Ö–æ–¥—Å—Ç–≤–æ > 80%, —Å—á–∏—Ç–∞–µ–º –Ω–µ—É–Ω–∏–∫–∞–ª—å–Ω–æ–π
      if (sim > 0.8) return false;
    }

    return true;
  }

  /**
   * –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞
   */
  editDistance(a, b) {
    const matrix = [];

    for (let i = 0; i <= b.length; i++) {
      matrix[i] = [i];
    }

    for (let j = 0; j <= a.length; j++) {
      matrix[0][j] = j;
    }

    for (let i = 1; i <= b.length; i++) {
      for (let j = 1; j <= a.length; j++) {
        if (b.charAt(i - 1) === a.charAt(j - 1)) {
          matrix[i][j] = matrix[i - 1][j - 1];
        } else {
          matrix[i][j] = Math.min(
            matrix[i - 1][j - 1] + 1,
            matrix[i][j - 1] + 1,
            matrix[i - 1][j] + 1
          );
        }
      }
    }

    return matrix[b.length][a.length];
  }

  /**
   * –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç—ã
   */
  categorize(quote) {
    const categories = {
      location: ['–º–µ—Å—Ç–æ', '–≤–∏–¥', '—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ', '–Ω–∞—Ö–æ–¥–∏—Ç—Å—è', '—Ö–æ–¥—å–±—ã'],
      food: ['–µ–¥–∞', '–∑–∞–≤—Ç—Ä–∞–∫', '—Ä–µ—Å—Ç–æ—Ä–∞–Ω', '–≤–∫—É—Å–Ω–æ', '–±–ª—é–¥–æ'],
      service: ['–ø–µ—Ä—Å–æ–Ω–∞–ª', '–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ', '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', '–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π'],
      room: ['–Ω–æ–º–µ—Ä', '–∫–æ–º–Ω–∞—Ç–∞', '–∫—Ä–æ–≤–∞—Ç—å', '—á–∏—Å—Ç–æ', '—É—é—Ç–Ω–æ'],
      price: ['—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '–¥–æ—Ä–æ–≥–æ', '–¥–µ—à–µ–≤–æ', '–±—é–¥–∂–µ—Ç'],
      experience: ['–≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ', '—ç–º–æ—Ü–∏–∏', '–Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–π', '–≤–æ—Å—Ç–æ—Ä–≥']
    };

    const text = quote.text.toLowerCase();
    let maxScore = 0;
    let category = 'general';

    for (const [cat, keywords] of Object.entries(categories)) {
      let score = 0;
      keywords.forEach(keyword => {
        if (text.includes(keyword)) score++;
      });
      if (score > maxScore) {
        maxScore = score;
        category = cat;
      }
    }

    return category;
  }
}
```

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞

```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∑—ã–≤–∞
async function processReview(review) {
  const extractor = new QuoteExtractor();

  // 1. –ò–∑–≤–ª–µ—á—å —Ü–∏—Ç–∞—Ç—ã
  const rawQuotes = extractor.extractQuotes(review.content.text);

  // 2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—É—é —Ü–∏—Ç–∞—Ç—É
  const processedQuotes = [];
  for (const rawQuote of rawQuotes) {
    // –û—Ü–µ–Ω–∏—Ç—å –≤–∞–∂–Ω–æ—Å—Ç—å
    const importance = extractor.calculateImportance(rawQuote, review);

    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
    const category = extractor.categorize(rawQuote);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
    const existingQuotes = await Quote.find({ category });
    const isUnique = await extractor.isUnique(rawQuote, existingQuotes);

    // –¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
    if (importance >= 60 && isUnique) {
      processedQuotes.push({
        text: rawQuote.text,
        startIndex: rawQuote.startIndex,
        endIndex: rawQuote.endIndex,
        importance,
        category,
        isUnique: true,
        usedInArticles: []
      });
    }
  }

  // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–∏—Ç–∞—Ç—ã
  review.quotes = processedQuotes;
  review.processing.extractedQuotes = processedQuotes.length;
  review.processing.status = 'processed';
  review.processing.processedAt = new Date();

  await review.save();

  return processedQuotes;
}
```

---

## üìö –ö–∞—Ç–∞–ª–æ–≥ –¶–∏—Ç–∞—Ç (Quote Catalog)

### –°—Ö–µ–º–∞ –ö–∞—Ç–∞–ª–æ–≥–∞

```javascript
const QuoteCatalogSchema = new mongoose.Schema({
  quoteId: String,                 // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ü–∏—Ç–∞—Ç—ã

  // –¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã
  text: {
    type: String,
    required: true,
    index: 'text'                  // –¢–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
  },

  // –ò—Å—Ç–æ—á–Ω–∏–∫
  source: {
    reviewId: String,              // ID –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞
    partnerId: String,             // ID –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    author: String,                // –ê–≤—Ç–æ—Ä –æ—Ç–∑—ã–≤–∞
    date: Date                     // –î–∞—Ç–∞ –æ—Ç–∑—ã–≤–∞
  },

  // –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
  category: {
    type: String,
    enum: ['location', 'food', 'service', 'room', 'price', 'experience', 'general'],
    index: true
  },

  // –ú–µ—Ç—Ä–∏–∫–∏
  metrics: {
    importance: Number,            // 0-100
    sentiment: String,             // positive, negative, neutral
    length: Number,                // –î–ª–∏–Ω–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
    wordCount: Number              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤
  },

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  usage: {
    timesUsed: Number,             // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
    articlesUsed: [String],        // ID —Å—Ç–∞—Ç–µ–π
    lastUsed: Date                 // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  },

  // –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
  entities: {
    locations: [String],           // –£–ø–æ–º—è–Ω—É—Ç—ã–µ –º–µ—Å—Ç–∞
    people: [String],              // –£–ø–æ–º—è–Ω—É—Ç—ã–µ –ª—é–¥–∏
    dates: [String]                // –£–ø–æ–º—è–Ω—É—Ç—ã–µ –¥–∞—Ç—ã
  },

  // –°—Ç–∞—Ç—É—Å
  status: {
    approved: Boolean,             // –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞
    featured: Boolean,             // –ò–∑–±—Ä–∞–Ω–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞
    archived: Boolean              // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
  }
});
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ö–æ–º–ø–∏–ª—è—Ü–∏—è –°—Ç–∞—Ç–µ–π

### –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –°—Ç–∞—Ç–µ–π

```javascript
class ArticleCompiler {
  /**
   * –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å—Ç–∞—Ç—å–∏ –∏–∑ —Ü–∏—Ç–∞—Ç
   */
  async compileArticle(topic, quotesData) {
    // 1. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã
    const quotes = await this.getRelevantQuotes(topic);

    // 2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    const grouped = this.groupQuotesByCategory(quotes);

    // 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç–∞—Ç—å–∏
    const article = {
      title: topic.title,
      introduction: this.generateIntroduction(topic),
      sections: []
    };

    // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ü–∏–π
    for (const [category, categoryQuotes] of Object.entries(grouped)) {
      const section = {
        title: this.getCategoryTitle(category),
        content: this.compileSection(categoryQuotes),
        quotes: categoryQuotes
      };
      article.sections.push(section);
    }

    // 5. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
    article.conclusion = this.generateConclusion(quotes);

    return article;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
   */
  async getRelevantQuotes(topic) {
    return await QuoteCatalog.find({
      $or: [
        { 'entities.locations': { $in: topic.locations } },
        { text: { $regex: new RegExp(topic.keywords.join('|'), 'i') } }
      ],
      'status.approved': true,
      'metrics.importance': { $gte: 70 }
    })
    .sort({ 'metrics.importance': -1 })
    .limit(50);
  }

  /**
   * –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   */
  groupQuotesByCategory(quotes) {
    const grouped = {};

    quotes.forEach(quote => {
      const cat = quote.category;
      if (!grouped[cat]) grouped[cat] = [];
      grouped[cat].push(quote);
    });

    return grouped;
  }

  /**
   * –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å–µ–∫—Ü–∏–∏
   */
  compileSection(quotes) {
    let content = '';

    // –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∫ —Å–µ–∫—Ü–∏–∏
    content += this.generateSectionIntro(quotes[0].category) + '\n\n';

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç
    quotes.forEach((quote, index) => {
      content += `> "${quote.text}"\n`;
      content += `> ‚Äî ${quote.source.author}\n\n`;

      // –ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É —Ü–∏—Ç–∞—Ç–∞–º–∏
      if (index < quotes.length - 1) {
        content += this.generateTransition() + '\n\n';
      }
    });

    return content;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –∫ —Å–µ–∫—Ü–∏–∏
   */
  generateSectionIntro(category) {
    const intros = {
      location: '–¢—É—Ä–∏—Å—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ –æ—Ç–º–µ—á–∞—é—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–∏–¥—ã:',
      food: '–ú–Ω–æ–≥–∏–µ –≥–æ—Å—Ç–∏ –≤—ã—Å–æ–∫–æ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è:',
      service: '–û–± –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø–∏—à—É—Ç —Å–ª–µ–¥—É—é—â–µ–µ:',
      room: '–ö–æ–º—Ñ–æ—Ä—Ç –Ω–æ–º–µ—Ä–æ–≤ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫:',
      price: '–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Ç–∞–∫:',
      experience: '–û–±—â–∏–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –æ—Ç –ø–æ—Å–µ—â–µ–Ω–∏—è:'
    };

    return intros[category] || '–û—Ç–∑—ã–≤—ã –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π:';
  }

  /**
   * –ü–µ—Ä–µ—Ö–æ–¥–Ω—ã–µ —Ñ—Ä–∞–∑—ã
   */
  generateTransition() {
    const transitions = [
      '–î—Ä—É–≥–æ–π —Ç—É—Ä–∏—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç:',
      '–ï—â—ë –æ–¥–∏–Ω –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –æ—Ç–º–µ—á–∞–µ—Ç:',
      '–ü–æ—Ö–æ–∂–∏–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è —É —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ—Å—Ç—è:',
      '–¢–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å:',
      '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ:'
    ];

    return transitions[Math.floor(Math.random() * transitions.length)];
  }
}
```

### –°—Ö–µ–º–∞ –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –°—Ç–∞—Ç—å–∏

```javascript
const CompiledArticleSchema = new mongoose.Schema({
  articleId: String,

  // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  title: String,
  slug: String,
  topic: {
    type: String,
    locations: [String],
    keywords: [String]
  },

  // –ö–æ–Ω—Ç–µ–Ω—Ç
  content: {
    introduction: String,
    sections: [{
      title: String,
      category: String,
      content: String,              // –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
      quotesUsed: [String]          // ID –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
    }],
    conclusion: String
  },

  // –ò—Å—Ç–æ—á–Ω–∏–∫–∏
  sources: {
    totalQuotes: Number,
    totalPartners: Number,
    partners: [{
      partnerId: String,
      partnerName: String,
      quotesContributed: Number
    }]
  },

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  stats: {
    wordCount: Number,
    readingTime: Number,            // –ú–∏–Ω—É—Ç—ã
    lastCompiled: Date,
    timesUpdated: Number
  },

  // –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  version: {
    major: Number,
    minor: Number,
    full: String                    // "v1.2"
  },

  // –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–ø–∏–ª—è—Ü–∏–π
  compilationHistory: [{
    version: String,
    compiledAt: Date,
    quotesAdded: Number,
    quotesRemoved: Number
  }],

  // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
  published: {
    status: Boolean,
    publishedAt: Date,
    updatedAt: Date
  }
});
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RSS/Atom

### RSS Feed –¥–ª—è –ü–∞—Ä—Ç–Ω—ë—Ä–æ–≤

```javascript
class RSSIntegration {
  /**
   * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RSS –ø–∞—Ä—Ç–Ω—ë—Ä–∞
   */
  async connectPartnerRSS(partner) {
    const Parser = require('rss-parser');
    const parser = new Parser();

    try {
      const feed = await parser.parseURL(partner.reviewsAPI.endpoint);

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ feed
      for (const item of feed.items) {
        await this.processRSSItem(item, partner);
      }

      partner.reviewsAPI.lastSync = new Date();
      await partner.save();

    } catch (error) {
      console.error(`RSS sync error for ${partner.name}:`, error);
    }
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ RSS —ç–ª–µ–º–µ–Ω—Ç–∞
   */
  async processRSSItem(item, partner) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ
    const existing = await Review.findOne({
      'source.originalUrl': item.link
    });

    if (existing) return;

    // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
    const review = new Review({
      reviewId: this.generateReviewId(partner),
      source: {
        partnerId: partner.partnerId,
        partnerName: partner.name,
        originalUrl: item.link,
        importedAt: new Date()
      },
      author: {
        name: this.extractAuthor(item),
        verified: false
      },
      content: {
        title: item.title,
        text: item.contentSnippet || item.content,
        date: new Date(item.pubDate),
        language: this.detectLanguage(item.content)
      },
      processing: {
        status: 'pending'
      }
    });

    await review.save();

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
    await processReview(review);
  }

  /**
   * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   */
  startAutoSync(interval = 3600000) { // 1 —á–∞—Å
    setInterval(async () => {
      const partners = await Partner.find({
        'reviewsAPI.endpoint': { $exists: true },
        'affiliate.status': 'active'
      });

      for (const partner of partners) {
        await this.connectPartnerRSS(partner);
      }
    }, interval);
  }
}
```

---

## üì§ –û–±—Ä–∞—Ç–Ω–∞—è –°–≤—è–∑—å –ü–∞—Ä—Ç–Ω—ë—Ä–∞–º

### –í–∏–¥–∂–µ—Ç –¥–ª—è –ü–∞—Ä—Ç–Ω—ë—Ä–æ–≤

```javascript
/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ —Å–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç–∞—Ç—å—è–º–∏
 */
class PartnerWidgetGenerator {
  generateWidget(partner, articles) {
    return `
      <!-- –í–∏–¥–∂–µ—Ç –°–≤–æ–±–æ–¥–Ω–æ–π –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏ –¢—É—Ä–∏–∑–º–∞ -->
      <div id="travel-wiki-widget" data-partner="${partner.partnerId}">
        <h3>üìö –°—Ç–∞—Ç—å–∏ –∏–∑ –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏ –¢—É—Ä–∏–∑–º–∞</h3>
        <div class="widget-articles">
          ${articles.map(article => `
            <div class="widget-article">
              <h4>${article.title}</h4>
              <p>${article.content.introduction.substring(0, 200)}...</p>
              <a href="${article.url}" target="_blank">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
              <div class="widget-contribution">
                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${article.quotesFromThisPartner} —Ü–∏—Ç–∞—Ç –∏–∑ –≤–∞—à–∏—Ö –æ—Ç–∑—ã–≤–æ–≤
              </div>
            </div>
          `).join('')}
        </div>
      </div>

      <script src="https://travel-wiki.com/widget.js"></script>
    `;
  }

  /**
   * API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
   */
  async getWidgetForPartner(partnerId) {
    // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—å–∏, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ü–∏—Ç–∞—Ç—ã —ç—Ç–æ–≥–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    const articles = await CompiledArticle.find({
      'sources.partners.partnerId': partnerId,
      'published.status': true
    }).limit(5);

    // –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞—Ç—å–∏ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å –≤–∫–ª–∞–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    const enrichedArticles = articles.map(article => {
      const partnerContribution = article.sources.partners.find(
        p => p.partnerId === partnerId
      );

      return {
        ...article.toObject(),
        quotesFromThisPartner: partnerContribution?.quotesContributed || 0,
        url: `https://travel-wiki.com/articles/${article.slug}`
      };
    });

    const partner = await Partner.findOne({ partnerId });

    return this.generateWidget(partner, enrichedArticles);
  }
}
```

---

## üéØ Use Case: –í–µ–Ω–µ—Ü–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π

**–ü–∞—Ä—Ç–Ω—ë—Ä—ã –≤ –í–µ–Ω–µ—Ü–∏–∏:**
- Grand Hotel Venezia (100 –æ—Ç–∑—ã–≤–æ–≤)
- Ristorante Italiano (75 –æ—Ç–∑—ã–≤–æ–≤)
- Venice Tours (50 –æ—Ç–∑—ã–≤–æ–≤)

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ò–º–ø–æ—Ä—Ç –æ—Ç–∑—ã–≤–æ–≤:**
   - –ß–µ—Ä–µ–∑ RSS –∫–∞–∂–¥—ã–π —á–∞—Å
   - –ß–µ—Ä–µ–∑ API —Ä–∞–∑ –≤ –¥–µ–Ω—å
   - –í—Å–µ–≥–æ: 225 –æ—Ç–∑—ã–≤–æ–≤

2. **–≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è —Ü–∏—Ç–∞—Ç:**
   - –ò–∑–≤–ª–µ—á–µ–Ω–æ: 487 —Ü–∏—Ç–∞—Ç
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: 156 —Ü–∏—Ç–∞—Ç
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: location (45), food (32), service (29), experience (50)

3. **–ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å—Ç–∞—Ç—å–∏:**
   ```markdown
   # –í–µ–Ω–µ—Ü–∏—è: –ì–æ—Ä–æ–¥ –Ω–∞ –í–æ–¥–µ ‚Äî –û—Ç–∑—ã–≤—ã –¢—É—Ä–∏—Å—Ç–æ–≤

   ## –í–≤–µ–¥–µ–Ω–∏–µ
   –í–µ–Ω–µ—Ü–∏—è ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –º–∏—Ä–∞.
   –í–æ—Ç —á—Ç–æ –ø–∏—à—É—Ç –æ –Ω–µ–π —Ç—É—Ä–∏—Å—Ç—ã.

   ## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –í–∏–¥—ã
   –¢—É—Ä–∏—Å—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ –æ—Ç–º–µ—á–∞—é—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–∏–¥—ã:

   > "–í–∏–¥ –∏–∑ –æ–∫–Ω–∞ –Ω–∞ –ì—Ä–∞–Ω–¥-–∫–∞–Ω–∞–ª –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π!"
   > ‚Äî –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞

   –î—Ä—É–≥–æ–π —Ç—É—Ä–∏—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç:

   > "–ü–ª–æ—â–∞–¥—å –°–∞–Ω-–ú–∞—Ä–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å–µ–≥–æ –≤ 5 –º–∏–Ω—É—Ç–∞—Ö —Ö–æ–¥—å–±—ã."
   > ‚Äî –î–∂–æ–Ω –°–º–∏—Ç

   ## –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ –í–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è
   –ú–Ω–æ–≥–∏–µ –≥–æ—Å—Ç–∏ –≤—ã—Å–æ–∫–æ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è:

   > "–ü–∞—Å—Ç–∞ —Å –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –≤ Ristorante Italiano ‚Äî
   > –ª—É—á—à–µ–µ, —á—Ç–æ —è –ø—Ä–æ–±–æ–≤–∞–ª!"
   > ‚Äî –ü—å–µ—Ä –î—é–ø–æ–Ω

   ## –°–µ—Ä–≤–∏—Å
   –û–± –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø–∏—à—É—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

   > "–ü–µ—Ä—Å–æ–Ω–∞–ª –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –≥–æ–≤–æ—Ä–∏—Ç –ø–æ-—Ä—É—Å—Å–∫–∏."
   > ‚Äî –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞

   ## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
   –ù–∞ –æ—Å–Ω–æ–≤–µ 225 –æ—Ç–∑—ã–≤–æ–≤ –æ—Ç 3 –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.
   ```

4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è:**
   - –°—Ç–∞—Ç—å—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –≤ —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏–∏
   - –í–∏–¥–∂–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º
   - –ü–∞—Ä—Ç–Ω—ë—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### –î–∞—à–±–æ—Ä–¥ –¥–ª—è –ü–∞—Ä—Ç–Ω—ë—Ä–æ–≤

```javascript
// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞
{
  partner: "Grand Hotel Venezia",
  period: "–î–µ–∫–∞–±—Ä—å 2024",

  reviews: {
    total: 100,
    processed: 100,
    quotesExtracted: 234
  },

  impact: {
    articlesCreated: 5,
    quotesUsed: 67,
    totalReach: 15000  // –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç–∞—Ç–µ–π
  },

  affiliate: {
    sales: 45,
    revenue: 67500,    // ‚Ç¨67,500
    commission: 3375   // ‚Ç¨3,375
  }
}
```

---

## üîê –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ –ö–∞—á–µ—Å—Ç–≤–æ

### –°–∏—Å—Ç–µ–º–∞ –ú–æ–¥–µ—Ä–∞—Ü–∏–∏

```javascript
const ModerationSchema = new mongoose.Schema({
  itemId: String,              // ID –æ—Ç–∑—ã–≤–∞/—Ü–∏—Ç–∞—Ç—ã
  itemType: String,            // review, quote, article

  status: {
    type: String,
    enum: ['pending', 'approved', 'rejected', 'flagged'],
    default: 'pending'
  },

  moderator: String,           // ID –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
  moderatedAt: Date,

  flags: [{
    type: String,              // spam, offensive, incorrect
    reporter: String,
    reportedAt: Date
  }],

  qualityScore: Number         // 0-100
});
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. ‚úÖ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)
2. üìã –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞ —Ü–∏—Ç–∞—Ç
3. üíª API –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
4. üîÑ RSS/Atom –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
5. üìö –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å—Ç–∞—Ç–µ–π
6. üé® –í–∏–¥–∂–µ—Ç—ã –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
7. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2024-12-28
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π –û–±—Ä–∞—Ç–Ω–æ–π –°–≤—è–∑–∏
